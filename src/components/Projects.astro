---
import Section from "./Section.astro";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import type { ProjectProps } from "@types";

interface Props {
  projects: ProjectProps[];
  sectionTitle: string;
  t: (key: any) => string;
}

const { projects, sectionTitle, t } = Astro.props;
---

<Section text={sectionTitle} href="projects">
  {
    projects.map(({ name, summary, image, linkPreview, linkSource, technologies, inProgress }, index) => {
      const top = 98 + index * 40;
      return (
        <div
          style={`top: ${top}px;`}
          class="sticky mb-12 rounded-2xl border border-theme bg-theme-primary"
        >
          <div class="bg-difu relative z-[1] grid w-full grid-rows-[auto_1fr] rounded-2xl bg-theme-secondary before:absolute before:inset-0 before:z-[-1] before:rounded-2xl before:bg-[url(/raja.png)] before:bg-[length:128px] before:bg-repeat before:opacity-[5%] before:content-[''] sm:grid-cols-2 sm:grid-rows-1 sm:h-96">
            <div class="px-6 py-8 flex flex-col min-h-0">
              <div class="mb-4">
                <h3 class="font-serif text-3xl font-medium text-primary">
                  {name}
                </h3>
              </div>
              <p class="text-base mb-4 line-clamp-4 text-theme-secondary">{summary}</p>
              
              {/* Tecnolog√≠as utilizadas */}
              <div class="flex flex-wrap gap-2 mb-6">
                {technologies.map((tech) => (
                  <div class="tech-badge">
                    <Icon name={tech} size={24} />
                  </div>
                ))}
              </div>
              
              <div class="flex gap-5 mt-auto pt-4 text-theme-primary border-t border-theme">
                {linkSource && (
                  <a
                    href={linkSource}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="flex items-center gap-2 hover:underline text-theme-primary"
                  >
                    {t("button.source")}
                    <Icon name="solar:arrow-right-up-linear" size={24} />
                  </a>
                )}
                {linkPreview && (
                  <a
                    href={linkPreview}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="flex items-center gap-2 hover:underline text-theme-primary"
                  >
                    {t("button.preview")}
                    <Icon name="solar:arrow-right-up-linear" size={24} />
                  </a>
                )}
              </div>
            </div>
            <div class="flex items-end justify-end overflow-hidden min-h-[300px] sm:min-h-0">
              {image ? (
                <Image
                  class="h-full w-[95%] rounded-ss-xl rounded-ee-2xl object-cover object-center sm:h-[85%] sm:w-full"
                  src={image}
                  alt={name}
                  width="736"
                  height="483"
                />
              ) : (
                <div class="h-full w-[95%] rounded-ss-xl rounded-ee-2xl bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center sm:h-[85%] sm:w-full border border-primary/10">
                  <div class="text-center p-8">
                    <svg
                      class="mx-auto w-20 h-20 text-primary/60 mb-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"
                      />
                    </svg>
                    <p class="text-primary/80 font-medium text-sm">{t("status.inProgress")}</p>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    })
  }
</Section>

<style>
  .tech-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.375rem;
    border-radius: 0.5rem;
    background-color: rgba(148, 163, 184, 0.1);
    border: 1px solid rgba(148, 163, 184, 0.2);
    transition: all 0.2s ease;
  }

  .tech-badge:hover {
    background-color: rgba(148, 163, 184, 0.15);
    border-color: rgba(148, 163, 184, 0.3);
    transform: translateY(-2px);
  }

  .tech-badge :global(svg) {
    filter: grayscale(50%) opacity(0.8);
    transition: filter 0.2s ease;
  }

  .tech-badge:hover :global(svg) {
    filter: grayscale(0%) opacity(1);
  }
</style>
